console.log("Lecture Summary is working");alert(" Im alive guys");var divElement=document.createElement("div");divElement.innerHTML=`\n      <div class="popup">\n           <div class="popup-top">\n             <h2>Lecture Summary</h2>\n              <div class="action">\n                <button class="popup-reload hide btn" title="reload extension">&#8634;</button>\n                <button class="popup-copy hide btn" title="copy to clipboard">&#128203;</button>\n                <button class="popup-save hide btn" title="download text file">&#128190;</button>\n                <button class="popup-copied hide btn" title="copied">&#10003;</button>\n                <button class="popup-close btn" title="close extension">&#10006;</button>\n              </div>\n           </div>\n           <div class="popup-content">\n             <div class="popup-error"></div>\n             <div class="popup-instruction"></div>\n             <p class="popup-video-title"></p>\n             <div id="summary" class="summary">\n             <p class="summary-paragraph center">  \n             Discover handpicked summaries of Udemy and Coursera video tutorials. Enhance your learning with clear and concise insights.<br> <span style="display: block; text-align:center;"> Start exploring now.</span>\n             </p>\n             </div>\n             <div class="popup-option-div"></div>\n             <div class="popup-generate">\n                 <button class="popup-generate-btn">Generate Summary</button>\n             </div>\n            </div>\n            <div class="popup-footer">\n             <div>\n                <a href="https://shishirchaurasiya.site/" class="shishir" alt="Shishir's Website link" target="_blank"> Developed by Shishir</a>\n             </div>\n              <div>\n                <a href="mailto:shishirchaurasiya435@gmail.com" alt="contact me through mail" target="_blank">&#9993;</a>\n              </div>\n            </div>\n      </div>\n  `;document.body.appendChild(divElement);var styleElement=document.createElement("style");styleElement.innerHTML=`\n@import url('https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600&display=swap');\n      .popup {\n          position: absolute;\n          top: 50px;\n          right: 20px;\n          z-index: 200;\n          text-align: center;\n          width: 300px;\n          border-radius: 10px;\n          font-family: 'Rubik', sans-serif;\n      }\n      .popup > *{\n        padding: 5px;\n      }\n      .popup-top,\n      .popup-footer{\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        // background-color: #b89404;\n        background-color: #010101;\n        padding: 2px 8px;\n        \n      }\n      .popup-top{\n        border-top-left-radius: 10px;\n        border-top-right-radius: 10px;\n      }\n      .popup-top h2{\n        font-weight: 400;\n        font-size: 16px;\n      }\n      .popup-content::-webkit-scrollbar{\n        width: 5px;\n        height: 13px;\n\n      }\n      .popup-content{\n        padding: 8px;\n        max-height: 400px;\n        overflow-y: scroll;\n      }\n      .summary-paragraph{\n        text-align: left;\n        margin: 20px 0;\n        font-size: 13px;\n      }\n      .hide{\n         display: none;\n      }\n      .btn{\n        height: 30px;\n        width: 30px;\n        cursor: pointer;\n        color: currentColor;\n        background-color: transparent;\n        border: none;\n        outline: none;\n        font-size: 15px;\n      }\n      .popup-generate-btn,\n      .popup-option-btn\n      {\n        cursor: pointer;\n        margin: 20px;\n        border-radius: 999px;\n        padding: 5px 10px;\n        border: 2px solid currentColor;\n        color: currentColor;\n        background-color: transparent;\n        transition: transform 0.2s ease-in-out;\n      }\n      .popup-generate-btn:hover,\n      .popup-option-btn:hover{\n       transform: translateY(-3px);\n       transform: scale(1.1);\n      }\n\n      .popup-reload{\n        font-size: 20px;\n      }\n      .action{\n        display: flex;\n        align-items: center;\n        transform: translateX(5px);\n      }\n      .action:not(:last-child){\n        gap: 5px;\n      }\n      .popup-footer{\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-bottom-left-radius: 10px;\n        border-bottom-right-radius: 10px;\n        padding: 4px 8px;\n      }\n      .popup-footer a, \n      .popup-footer a:visited{\n        color: currentColor;\n        text-decoration: none;\n      }\n      .popup-footer a:hover{\n        color: gray;\n      }\n      .shishir{\n        font-size: 13px;\n      }\n      .center{\n        text-align: center;\n      }\n      .popup-bullet-point{\n        transform: translateX(-8px);\n      }\n      .popup-option{\n        display: flex;\n        flex-direction: column;\n        gap: 5px;\n      }\n      .popup-option-input{\n        padding: 5px 10px;\n        margin: 5px 20px;\n        border-radius: 10px;\n      }\n  `;chrome.storage.local.get(["ghostApiKey"],(function(result){const apiKey=result.ghostApiKey;if(apiKey!==""&&apiKey!==undefined){getAndInjectSynopsis(apiKey)}else{var optionDiv=document.createElement("div");optionDiv.innerHTML=`\n        <div class="popup-option">\n        <p>Welcome to the Lecture Summary Chrome Extension!</p>\n    <p>Follow these simple steps to get started:</p>\n    <ol style="text-align: left;">\n        <li>Register on EdenAI by clicking <a href="https://app.edenai.run/admin/account/settings" alt="EdenAI register link" target="_blank">here</a></li>\n        <li>Obtain your Eden AI API Key by following the detailed steps provided in <a href="https://shishirchaurasiya.hashnode.dev/easy-steps-to-sign-up-on-eden-ai-and-access-your-api-key" target="_blank">this article</a></li>\n        <li>If you run into any challenges, check out our detailed video guide on YouTube: <a href="https://www.youtube.com/watch?v=GXCeArGY6TI&ab_channel=Shishir" target="_blank">Watch the Guide</a></li>\n    </ol>\n    <p>Once you have your API key, enter it below:</p>\n    <input type="text" id="apiKeyInput" class="popup-option-input" placeholder="Paste your API key here" autofocus>\n    <button id="submitApiKey" class="popup-option-btn">Submit</button>\n        </div>\n        `;const optionPopup=document.querySelector(".popup-option-div");optionPopup.appendChild(optionDiv);const summaryParagraph=document.querySelector(".summary-paragraph");const generateBtn=document.querySelector(".popup-generate-btn");summaryParagraph.textContent="";generateBtn.classList.add("hide");console.log("API key not found. Please enter your API key.");const apiKeyInput=document.getElementById("apiKeyInput");const submitApiKey=document.getElementById("submitApiKey");submitApiKey.addEventListener("click",(function(){const synopsisApiKey=apiKeyInput.value;if(synopsisApiKey){chrome.storage.local.set({ghostApiKey:synopsisApiKey},(function(){optionPopup.classList.add("hide")}));summaryParagraph.textContent="API key successfully saved. Close the extension, then reopen it by clicking once more."}}))}}));function userPreference(){const popup=document.querySelector(".popup");const popupActionBtn=document.querySelector(".action");const generateDiv=document.querySelector(".popup-generate");const optionDiv=document.querySelector(".popup-option-div");if(window.matchMedia("(prefers-color-scheme: dark)").matches){popup.style.backgroundColor="#292929";popup.style.color="#fff";popupActionBtn.style.color="#fff";generateDiv.style.color="#fff";optionDiv.style.color="#fff"}else{popup.style.backgroundColor="#f2f2f2";popup.style.color="#212121";popupActionBtn.style.color="#212121";generateDiv.style.color="#212121";optionDiv.style.color="#212121"}}userPreference();document.head.appendChild(styleElement);function closeButton(){let closeButton=document.querySelector(".popup-close");closeButton.addEventListener("click",(function(){document.body.removeChild(divElement);chrome.runtime.sendMessage({action:"closeButtonClicked"})}))}closeButton();function numberOfWords(text){const words=text.split(/\s+/);return words.length}function getTheTranscript(){const Udemy="https://www.udemy.com/course/";const Coursera="https://www.coursera.org/learn/";const Youtube="https://www.youtube.com/watch";let currentTabUrl=window.location.href;const summaryParagraph=document.querySelector(".summary-paragraph");if(currentTabUrl.startsWith(Udemy)){let TranscriptPanel=document.querySelector('[class^="transcript--transcript-panel"]');let TranscriptNode=document.querySelectorAll('[class^="transcript--cue"]');let sectionName=document.querySelector("[class^=lecture-view--container]").ariaLabel;let videoTitle=sectionName.slice(sectionName.indexOf("Lecture"));if(TranscriptNode.length===0){const reloadBtn=document.querySelector(".popup-reload");reloadBtn.classList.remove("hide");reloadBtn.addEventListener("click",(()=>{document.location.reload()}));summaryParagraph.textContent=`Kindly click the transcript button and give it another go.`;const generateBtn=document.querySelector(".popup-generate-btn");generateBtn.classList.add("hide");return undefined}let transcript=TranscriptPanel.innerText.replace(/\n/g,"");return[transcript,videoTitle]}else if(currentTabUrl.startsWith(Coursera)){let Transcript=Array.from(document.querySelectorAll(".rc-Phrase")).map((phrase=>phrase.textContent)).join(" ");let videoTitle=document.querySelector(".video-name").textContent;if(Transcript===""){const reloadBtn=document.querySelector(".popup-reload");reloadBtn.classList.remove("hide");reloadBtn.addEventListener("click",(()=>{document.location.reload()}));summaryParagraph.textContent=`Kindly click the transcript button and give it another go.`;const generateBtn=document.querySelector(".popup-generate-btn");generateBtn.classList.add("hide");return undefined}return[Transcript,videoTitle]}else if(currentTabUrl.startsWith(Youtube)){let Transcript=Array.from(document.querySelectorAll(".segment-text")).map((element=>element.textContent)).join(" ");let videoTitle=document.querySelector("h1.style-scope.ytd-watch-metadata").textContent.trim();if(Transcript===""){const reloadBtn=document.querySelector(".popup-reload");reloadBtn.classList.remove("hide");reloadBtn.addEventListener("click",(()=>{document.location.reload()}));summaryParagraph.textContent=`Kindly click the transcript button and give it another go.`;const generateBtn=document.querySelector(".popup-generate-btn");generateBtn.classList.add("hide");return undefined}if(numberOfWords(Transcript)>3e3){summaryParagraph.textContent=`The video transcript word length is greater than 3000 so I can not process it and give summary of it `;return undefined}return[Transcript,videoTitle]}}getTheTranscript();function copyToClipboard(){const summaryParagraph=document.querySelector(".summary-paragraph");const copyBtn=document.querySelector(".popup-copy");copyBtn.classList.remove("hide");copyBtn.addEventListener("click",(function(){const videoTitle=document.querySelector(".popup-video-title");videoTitle.textContent=getTheTranscript()[1];const listItems=Array.from(summaryParagraph.querySelectorAll("li"));let copiedText="•";copiedText+=listItems.map((item=>item.textContent)).join("\n•");navigator.clipboard.writeText(videoTitle.textContent+"\n"+copiedText).then((function(){const checkMarkIcon=document.createElement("span");checkMarkIcon.innerHTML="&#10003;";copyBtn.textContent="";copyBtn.appendChild(checkMarkIcon);setTimeout((function(){const clipboardIcon=document.createElement("span");clipboardIcon.innerHTML="&#128203;";copyBtn.textContent="";copyBtn.appendChild(clipboardIcon)}),3e3)})).catch((function(error){const popupError=document.querySelector(".popup-error");popupError.textContent=`'Clipboard write failed:', ${error}`;console.error("Clipboard write failed:",error)}))}))}function downloadTxt(){const summaryParagraph=document.querySelector(".summary-paragraph");const saveBtn=document.querySelector(".popup-save");saveBtn.classList.remove("hide");saveBtn.addEventListener("click",(function(){const videoTitle=document.querySelector(".popup-video-title");videoTitle.textContent=getTheTranscript()[1];const listItems=Array.from(summaryParagraph.querySelectorAll("li"));let copiedText="•";copiedText+=listItems.map((item=>item.textContent)).join("\n•");const txtText=videoTitle.textContent+"\n"+copiedText;const downloadPromise=new Promise(((resolve,reject)=>{const blob=new Blob([txtText],{type:"text/plain"});const url=URL.createObjectURL(blob);const anchor=document.createElement("a");anchor.href=url;anchor.download=`${videoTitle.textContent}.txt`;anchor.click();URL.revokeObjectURL(url);resolve()}));downloadPromise.then((function(){const checkMarkIcon=document.createElement("span");checkMarkIcon.innerHTML="&#10003;";saveBtn.textContent="";saveBtn.appendChild(checkMarkIcon);setTimeout((function(){const savedIcon=document.createElement("span");savedIcon.innerHTML="&#128190;";saveBtn.textContent="";saveBtn.appendChild(savedIcon)}),3e3)})).catch((function(error){const popupError=document.querySelector(".popup-error");popupError.textContent=`Sorry, we encountered an issue while trying to save the text file. Please try again later or contact support for assistance.`;console.error("Failed to save text file:",error)}))}))}function getAndInjectSynopsis(synopsisApiKey){if(getTheTranscript().length!==0){let transcript=getTheTranscript()[0];let PromptText=`Summarize the provided \n ${transcript} \n in bullet point format, ensuring that the summary is approximately 30-40% of the original text. Please use concise and meaningful bullet points to capture the key points and main ideas.\n    you can divide each points by '\n-' `;let options={method:"POST",headers:{Authorization:`Bearer ${synopsisApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({output_sentences:7,providers:"openai",text:PromptText,language:"en"})};function convertToBulletPoints(response){const lines=response.split(/\n-|\n•/);const bulletPoints=lines.map((line=>{const firstColonIndex=line.indexOf(":");const lineWithoutFirstColon=firstColonIndex!==-1?line.slice(firstColonIndex+1):line;const trimmedLine=lineWithoutFirstColon.trim();return trimmedLine.length>0?`<li>${trimmedLine}</li>`:""}));const bulletPointsString=`<ul class="popup-bullet-point">${bulletPoints.join("")}</ul>`;return bulletPointsString}function appendBulletPoints(response){const summaryParagraph=document.querySelector(".summary-paragraph");const bulletPoints=convertToBulletPoints(response);summaryParagraph.textContent="";summaryParagraph.classList.remove("center");console.log("from promise",bulletPoints);summaryParagraph.innerHTML=bulletPoints}const generateBtn=document.querySelector(".popup-generate-btn");generateBtn.addEventListener("click",(function(){generateBtn.textContent="Generating Synopsis...";fetch("https://api.edenai.run/v2/text/summarize",options).then((response=>{console.log("inside fetch");console.log(response);if(response.status===401||response.status===403){const summaryParagraph=document.querySelector(".summary-paragraph");summaryParagraph.textContent="We apologize, but it seems there's an issue with your API key. Please provide your API key and ensure that it is correctly entered in a single line.";var optionDiv=document.createElement("div");optionDiv.innerHTML=`\n          <div class="popup-option">\n          <p>Follow these simple steps to get started:</p>\n         <ol>\n        <li>Register on EdenAI by clicking <a href="https://app.edenai.run/admin/account/settings" alt="EdenAI register link" target="_blank">here</a></li>\n        <li>Obtain your Eden AI API Key by following the detailed steps provided in <a href="https://shishirchaurasiya.hashnode.dev/easy-steps-to-sign-up-on-eden-ai-and-access-your-api-key" target="_blank">this informative article</a></li>\n        <li>If you run into any challenges, check out our detailed video guide on YouTube: <a href="https://www.youtube.com/watch?v=GXCeArGY6TI&ab_channel=Shishir" target="_blank">Watch the Guide</a></li>\n        </ol>\n          <p>Once you have your API key, enter it below:</p>\n        <input type="text" id="apiKeyInput" class="popup-option-input" autofocus>\n        <button id="submitApiKey" class="popup-option-btn">Submit</button>\n        </div>\n            `;const optionPopup=document.querySelector(".popup-option-div");optionPopup.appendChild(optionDiv);const generateBtn=document.querySelector(".popup-generate-btn");generateBtn.classList.add("hide");console.log("API key not found. Please enter your API key.");const apiKeyInput=document.getElementById("apiKeyInput");const submitApiKey=document.getElementById("submitApiKey");submitApiKey.addEventListener("click",(function(){const synopsisApiKey=apiKeyInput.value;if(synopsisApiKey){chrome.storage.local.set({ghostApiKey:synopsisApiKey},(function(){optionPopup.classList.add("hide")}));summaryParagraph.textContent="API key successfully saved. Close the extension, then reopen it by clicking once more"}}));console.error(`Oops! It looks like your api key is wrong. please submit api key and make sure that it is in a single line\n `)}else if(!response.ok){const generateBtn=document.querySelector(".popup-generate-btn");generateBtn.classList.add("hide");throw new Error(`Oops! Something went wrong while fetching the summary. Please refresh the page and try again. Error Code: ${response.status} \n `)}return response.json()})).then((data=>{console.log(data);const res=data.openai.result;console.log(res);const generateBtn=document.querySelector(".popup-generate-btn");appendBulletPoints(res);let title=getTheTranscript();const videoTitle=document.querySelector(".popup-video-title");videoTitle.textContent=title[1];generateBtn.classList.add("hide");copyToClipboard();downloadTxt()})).catch((error=>{console.error(error)}))}))}}